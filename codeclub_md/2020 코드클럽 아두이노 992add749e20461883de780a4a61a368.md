# 2020 코드클럽 아두이노

### -세그먼트와 버튼을 이용한 반응속도 게임

게임 설명:
1. 세그먼트에서 3,2,1 카운트가 표시됩니다.
2. 카운트가 지난 후 랜덤으로 왼쪽 OR 오른쪽의 LED가 켜졌다 꺼집니다.
3. 그에 맞게 왼쪽 OR 오른쪽의 버튼을 누르면 세그먼트에 반응속도 수치가 표시됩니다.

*만약 올바르지 않은 버튼을 눌렀을 시 시리얼 모니터에 "Worng!"이라고 표시됩니다.

- 팀원
    - 메인 : 권현수
    - 보조 : 강종연

- 준비물
    - 아두이노 보드 1개, USB케이블
    - 브레드보드 1개
    - 버튼 2개
    - 네 자리 7세그먼트 1개
    - LED 2개
    - 점퍼케이블 21개
    - 아두이노가 깔린 컴퓨터

- 회로도

    ![2020%20%E1%84%8F%E1%85%A9%E1%84%83%E1%85%B3%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A5%E1%86%B8%20%E1%84%8B%E1%85%A1%E1%84%83%E1%85%AE%E1%84%8B%E1%85%B5%E1%84%82%E1%85%A9%20992add749e20461883de780a4a61a368/Codeclub_0_bb.png](2020%20%E1%84%8F%E1%85%A9%E1%84%83%E1%85%B3%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A5%E1%86%B8%20%E1%84%8B%E1%85%A1%E1%84%83%E1%85%AE%E1%84%8B%E1%85%B5%E1%84%82%E1%85%A9%20992add749e20461883de780a4a61a368/Codeclub_0_bb.png)

회로도는 위와 같이 연결하면 되고 이제부터는 같이 코딩을 진행해볼게요!

LED→버튼→세그먼트 순으로 가봅시다~!!

### 우선 LED!

LED선을 각각 A0, A1에 연결했기에 그에 맞게 선언 해주고 저희는 랜덤으로 불을 켜줘야 하기에 랜덤변수를 선언하여 LED를 HIGH로 설정하여 켜줄겁니다.
그리고 깜빡이는 것이 저희 목적이니 켜진 불들은 LOW로 설정하여 다시 꺼줍시다!

```arduino
//2020 코드클럽

char led_green = A1;
char led_red = A0;

void setup() {
  Serial.begin(9600);
  
  pinMode(led_red, OUTPUT);
  pinMode(led_green, OUTPUT);

}

void loop() {

  //난수 생성
  temp = random(0,2);
  Serial.print(temp);
  
  if(temp == 0){
    digitalWrite(led_red, HIGH);
  }
  else if(temp == 1){
    digitalWrite(led_green, HIGH);
  }

	digitalWrite(led_red, LOW);
  digitalWrite(led_green, LOW);
}
```

### 다음은 버튼!

저희는 회로도에서 왼쪽 버튼은 A3, 오른쪽 버튼은 A2에 연결했기에 그에 맞게 선언해줍시다.
버튼들을 INPUT_PULLUP으로 설정하여 눌려져있으면 LOW, 아니라면 HIGH 값을 반환합니다.
그 이후 무한루프로 돌면서 LED에 맞게 버튼이 눌러졌는지 체크를 하여 시리얼 모니터에 표시를 하게 만들어봅시다!

```arduino
//2020 코드클럽

//버튼 제어
char sw1 = A2;
char sw2 = A3;

char led_green = A1;
char led_red = A0;

void setup() {
  Serial.begin(9600);
  
  pinMode(led_red, OUTPUT);
  pinMode(led_green, OUTPUT);

	//SW를 인풋_풀업으로 하여 버튼이 열려있다면 HIGH, 닫혀있다면 low값을 반환
  pinMode(sw1, INPUT_PULLUP);
  pinMode(sw2, INPUT_PULLUP);
}

void loop() {
  
  //난수 생성
  temp = random(0,2);
  Serial.print(temp);
  
  if(temp == 0){
    digitalWrite(led_red, HIGH);
  }
  else if(temp == 1){
    digitalWrite(led_green, HIGH);
  }

  while(true){
    if(digitalRead(sw1) == LOW && temp == 0){
      Serial.println("correct!");
      break;
    }
    else if(digitalRead(sw2) == LOW && temp == 1){
      Serial.println("correct!");
      break;
    }

    else if(digitalRead(sw1) == LOW && temp == 1){
      Serial.println("Wrong!");
      break;
    }
    
    else if(digitalRead(sw2) == LOW && temp == 0){
      Serial.println("Wrong!");
      break;
    }
  }
    
  digitalWrite(led_red, LOW);
  digitalWrite(led_green, LOW);
}
```

### 마지막은 대망의 세그먼트!

~~잘 따라오셔야해요. 진짜 어려워요..ㅠㅠㅠ~~

![2020%20%E1%84%8F%E1%85%A9%E1%84%83%E1%85%B3%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A5%E1%86%B8%20%E1%84%8B%E1%85%A1%E1%84%83%E1%85%AE%E1%84%8B%E1%85%B5%E1%84%82%E1%85%A9%20992add749e20461883de780a4a61a368/KakaoTalk_20200920_194431269.png](2020%20%E1%84%8F%E1%85%A9%E1%84%83%E1%85%B3%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A5%E1%86%B8%20%E1%84%8B%E1%85%A1%E1%84%83%E1%85%AE%E1%84%8B%E1%85%B5%E1%84%82%E1%85%A9%20992add749e20461883de780a4a61a368/KakaoTalk_20200920_194431269.png)

우선 세그먼트는 핀이 총 12개로 4개는 세그먼트 4자리 결정 핀이고 나머지 8개는 세그먼트를 제어하는 핀이에요.

회로도보고 하나하나 연결하신 후 0~9까지 표시할 수 있는 세그먼트 값을 data 배열에 넣어 줍시다.
이후 세그먼트핀과 4자리 결정핀들을 출력용으로 설정해주고 시간을 설정해봅시다.

millis함수를 이용하여 시작과 끝 지점의 시간체크후 차이를 이용하여 걸린 시간을 구해줍니다.
이제는 그 걸린 시간을 표시해줘야되겠죠??

show함수를 만들어서 세그먼트의 값들을 위의 data배열에 넣었던 값들을 이용하여 하나하나 설정해줍시다!

그 후 다시 loop로 돌아와서 걸린 시간을 show 함수를 이용하여 각 자리마다 출력하게 만들면
**완성!!!**

```arduino
//2020 코드클럽

//세그먼트
int position_pin[] = {1,2,3,4};               //4자리 결정 핀
int segment_pin[] = {5,6,7,8,9,10,11,12};     //세그먼트 제어 핀
const int delayTime = 1000;                      //일시정지 시간

//0 ~ 9를 표현하는 세그먼트 값
byte data[] = {0xFC, 0x60, 0xDA, 0xF2, 0x66, 0xB6, 0xBE, 0xE4, 0xFE, 0xE6};

int temp = 0;
int t_start = 0;
int t_end = 0;
int t_ = 0;

//버튼 제어
char sw1 = A2;
char sw2 = A3;

char led_green = A1;
char led_red = A0;

void setup() {
  Serial.begin(9600);
  
  pinMode(led_red, OUTPUT);
  pinMode(led_green, OUTPUT);

	//SW를 인풋_풀업으로 하여 버튼이 열려있다면 HIGH, 닫혀있다면 low값을 반환
  pinMode(sw1, INPUT_PULLUP);
  pinMode(sw2, INPUT_PULLUP);
    
  //4자리 결정 핀 출력용으로 설정
  for(int i = 0; i < 4; i++) {
     pinMode(position_pin[i], OUTPUT);
  }

  //세그먼트 제어 핀 출력용으로 설정
  for(int i = 0; i < 8; i++) {
    pinMode(segment_pin[i], OUTPUT);
  }

  
  
}

void loop() {
  
  //3,2,1 카운트 다운
  show(4,3);
  delay(delayTime);
  show(4,2);
  delay(delayTime);
  show(4,1);
  delay(delayTime);

  
  //난수 생성
  temp = random(0,2);
  Serial.print(temp);
  t_start = millis();
  
  if(temp == 0){
    digitalWrite(led_red, HIGH);
  }

  else if(temp == 1){
    digitalWrite(led_green, HIGH);
  }

  while(true){
    if(digitalRead(sw1) == LOW && temp == 0){
      Serial.println("correct!");
      break;
    }
    else if(digitalRead(sw2) == LOW && temp == 1){
      Serial.println("correct!");
      break;
    }

    else if(digitalRead(sw1) == LOW && temp == 1){
      Serial.println("Wrong!");
      break;
    }
    
    else if(digitalRead(sw2) == LOW && temp == 0){
      Serial.println("Wrong!");
      break;
    }
  }
  
  t_end = millis();
  t_ = t_end - t_start;
  Serial.println(t_);
    
  digitalWrite(led_red, LOW);
  digitalWrite(led_green, LOW);
  for(int i = 0 ; i<100;i++){
    show(1,(t_%10000)/1000);
    delay(5);
    show(2,(t_%1000)/100);
    delay(5);
    show(3,(t_%100)/10);
    delay(5);
    show(4,t_%10);
    delay(5);
  }
  
  
  delay(500);
}

void show(int position, int number) {
  //4자리 중 원하는 자리 선택
  for(int i = 0; i < 4; i++) {
    if(i + 1 == position){
      digitalWrite(position_pin[i], LOW);
    } else {
      digitalWrite(position_pin[i], HIGH);
    }
  }

  //8개 세그먼트를 제어해서 원하는 숫자 출력
  for(int i = 0; i < 8; i++){
     byte segment = (data[number] & (0x01 << i)) >> i;
     if(segment == 1){
       digitalWrite(segment_pin[7 - i], HIGH);
     } else {
       digitalWrite(segment_pin[7 - i], LOW);
     }
  }
}
```